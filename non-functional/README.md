# Non Functional Requirements

## How it works ?

Our load testing framework is based on [locust.io v1.4.0](https://docs.locust.io/en/stable/) that is used with Python 3

This framework is based in src/locust.py file. This file contains all the logic for the load testing. Right now is only set to verify that the response is 200, but you will see that there is a line commented that shows the response of the data (You can check the locustfile.log)

The logic is very simple, is just testing the GET person/all endpoint. You can see that there is a variable called wait_time. This variable will wait between 1 and 2 seconds before re starting the process, that is why you will need to have 600 users in order to achieve 300 RPS constantly. The idea behind this framework is to test how many concurrent users you can have on the application but also you can see Request Per Seconds (RPS) metrics and much more

## How to Set up Locust Locally

1. Install Python. Make sure you download the latest version of Python 3
2. Install Pip for Python 3
3. Install Virtualenv
   - `pip3 install virtualenv`
4. Create a virtualenv for the actual project
   - `virtualenv -p python3 <path/to/new/virtualenv/>`
5. Activate the virtual env in the loadTesting Project
   - `source <path/to/new/virtualenv>/bin/activate`
6. Install the pip packages needed by this project
   - `pip install -r </path/to/load/testing/project/>requirements.txt`
7. Run the locust tests locally

- No Web: `locust -f ./src/locust.py --logfile=./locustfile.log --loglevel=DEBUG --headless -u 600 -r 50 -t 60s -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com`
  - Parameters from No Web:
    - **-u**: Number of users generated by Locust
  - **-r**: Time in seconds untill a new user starts executing tasks (with a maximum of the number of users defined by -c) - Hatch rate of users. For example if you set 1, 1 user per second will be added until the maximum amount of users (c) is reached
    - **-t**: How long the Locust tests should be running
- Web: `locust -f ./src/locust.py --logfile=./locustfile.log -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com`
- Web Dev: `locust -f ./locust.py --logfile=./locustfile.log -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com`

  After this you will need to open your browser in localhost:8089 and enter the number of users to hatch for example 600 in order to perform 300 operations per second as it was requested in the inverview document.

  In order to stop the process you will need to kill the process in the terminal

**Note**: If you receive an error running the test that Locust is not found, open a new terminal and activate again the Virtual Env will it

## Docker Image

I have created a Dockerfile in order to make it easy for the person who will review this. Installing Python, pip sometimes can take time if you did not have installed it previously

1. Open a Terminal
2. Run `docker build -t lt-basf .`
3. Run `docker run -ti -p 8089:8089 -e "OPTS=--logfile=./locustfile.log --loglevel=DEBUG --headless -u 600 -r 50 -t 60s -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com" lt-basf`

## Results (only with empty database; otherwise no output)

```
user@azure-host:~/challenges/test/LucasHartridge/non-functional$ docker run -ti -p 8089:8089 -e "OPTS=--logfile=./locustfile.log --loglevel=DEBUG --headless -u 600 -r 50 -t 60s -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com" lt-basf
locust -f locust.py --logfile=./locustfile.log --loglevel=DEBUG --headless -u 600 -r 50 -t 60s -H http://azure-qknows-prod-challenges-1.northeurope.cloudapp.azure.com
 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                         0     0(0.00%)  |       0       0       0       0  |    0.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                               63     0(0.00%)  |     429       2     885     440  |    0.00    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                        63     0(0.00%)  |     429       2     885     440  |    0.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                              204     0(0.00%)  |     486       2    1537     270  |   31.00    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                       204     0(0.00%)  |     486       2    1537     270  |   31.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                              434     0(0.00%)  |     537       2    2578      65  |   50.00    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                       434     0(0.00%)  |     537       2    2578      65  |   50.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                              735     0(0.00%)  |     558       2    3454      75  |   70.50    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                       735     0(0.00%)  |     558       2    3454      75  |   70.50    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             1047     0(0.00%)  |     649       2    4437     110  |   90.00    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      1047     0(0.00%)  |     649       2    4437     110  |   90.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             1446     0(0.00%)  |     733       2    5071     200  |  103.30    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      1446     0(0.00%)  |     733       2    5071     200  |  103.30    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             1952     0(0.00%)  |     802       2    5233     300  |  137.10    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      1952     0(0.00%)  |     802       2    5233     300  |  137.10    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             2668     0(0.00%)  |     876       2    5405     200  |  173.90    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      2668     0(0.00%)  |     876       2    5405     200  |  173.90    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             3444     0(0.00%)  |     680       2    5405      63  |  221.80    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      3444     0(0.00%)  |     680       2    5405      63  |  221.80    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             4252     0(0.00%)  |     551       2    5405       8  |  269.30    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      4252     0(0.00%)  |     551       2    5405       8  |  269.30    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             5046     0(0.00%)  |     465       2    5405       6  |  317.80    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      5046     0(0.00%)  |     465       2    5405       6  |  317.80    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             5851     0(0.00%)  |     402       2    5405       5  |  357.60    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      5851     0(0.00%)  |     402       2    5405       5  |  357.60    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             6649     0(0.00%)  |     354       2    5405       5  |  387.40    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      6649     0(0.00%)  |     354       2    5405       5  |  387.40    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             7454     0(0.00%)  |     316       2    5405       5  |  398.40    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      7454     0(0.00%)  |     316       2    5405       5  |  398.40    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             8230     0(0.00%)  |     287       2    5405       5  |  400.10    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      8230     0(0.00%)  |     287       2    5405       5  |  400.10    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             9028     0(0.00%)  |     262       2    5405       5  |  399.20    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      9028     0(0.00%)  |     262       2    5405       5  |  399.20    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                             9821     0(0.00%)  |     241       2    5405       5  |  399.30    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                      9821     0(0.00%)  |     241       2    5405       5  |  399.30    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            10622     0(0.00%)  |     223       2    5405       5  |  397.60    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     10622     0(0.00%)  |     223       2    5405       5  |  397.60    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            11416     0(0.00%)  |     208       2    5405       5  |  396.40    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     11416     0(0.00%)  |     208       2    5405       5  |  396.40    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            12201     0(0.00%)  |     195       2    5405       5  |  396.40    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     12201     0(0.00%)  |     195       2    5405       5  |  396.40    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            13008     0(0.00%)  |     183       2    5405       5  |  395.90    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     13008     0(0.00%)  |     183       2    5405       5  |  395.90    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            13811     0(0.00%)  |     173       2    5405       5  |  395.60    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     13811     0(0.00%)  |     173       2    5405       5  |  395.60    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            14595     0(0.00%)  |     164       2    5405       5  |  398.10    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     14595     0(0.00%)  |     164       2    5405       5  |  398.10    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            15397     0(0.00%)  |     155       2    5405       5  |  396.60    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     15397     0(0.00%)  |     155       2    5405       5  |  396.60    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            16200     0(0.00%)  |     148       2    5405       5  |  397.70    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     16200     0(0.00%)  |     148       2    5405       5  |  397.70    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            16990     0(0.00%)  |     141       2    5405       4  |  400.10    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     16990     0(0.00%)  |     141       2    5405       4  |  400.10    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            17771     0(0.00%)  |     135       2    5405       4  |  400.10    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     17771     0(0.00%)  |     135       2    5405       4  |  400.10    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            18584     0(0.00%)  |     129       2    5405       4  |  396.30    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     18584     0(0.00%)  |     129       2    5405       4  |  396.30    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            19379     0(0.00%)  |     124       2    5405       4  |  399.00    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     19379     0(0.00%)  |     124       2    5405       4  |  399.00    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            20169     0(0.00%)  |     119       2    5405       4  |  399.20    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     20169     0(0.00%)  |     119       2    5405       4  |  399.20    0.00

 Name                                                          # reqs      # fails  |     Avg     Min     Max  Median  |   req/s failures/s
--------------------------------------------------------------------------------------------------------------------------------------------
 GET /api/person/all                                            20175     0(0.00%)  |     119       2    5405       4  |  335.89    0.00
--------------------------------------------------------------------------------------------------------------------------------------------
 Aggregated                                                     20175     0(0.00%)  |     119       2    5405       4  |  335.89    0.00

Response time percentiles (approximated)
 Type     Name                                                              50%    66%    75%    80%    90%    95%    98%    99%  99.9% 99.99%   100% # reqs
--------|------------------------------------------------------------|---------|------|------|------|------|------|------|------|------|------|------|------|
 GET      /api/person/all                                                     4      5      6      6     14    370   2600   4300   5100   5400   5400  20175
--------|------------------------------------------------------------|---------|------|------|------|------|------|------|------|------|------|------|------|
 None     Aggregated                                                          4      5      6      6     14    370   2600   4300   5100   5400   5400  20175
```
